resource "google_project" "my_project" {
  name       = "<%= ctx[:vars]['project_id'] %>"
  project_id = "<%= ctx[:vars]['project_id'] %>"
  org_id     = "<%= ctx[:test_env_vars]['org_id'] %>"
}

resource "google_project_service" "identity_platform_apis1" {
  project = google_project.my_project.project_id
  service = "appengine.googleapis.com"
}

resource "google_project_service" "identity_platform_apis2" {
  project = google_project.my_project.project_id
  service = "bigquerystorage.googleapis.com"
  disable_dependent_services = true
}

resource "google_project_service" "identity_platform_apis4" {
  project = google_project.my_project.project_id
  service = "firebaseinstallations.googleapis.com"
  disable_dependent_services = true
}

resource "google_project_service" "identity_platform_apis5" {
  project = google_project.my_project.project_id
  service = "firebasedynamiclinks.googleapis.com"
}

resource "google_project_service" "identity_platform_apis6" {
  project = google_project.my_project.project_id
  service = "firebasehosting.googleapis.com"
}

resource "google_identity_platform_default_supported_idp_config" "<%= ctx[:primary_resource_id] %>" {
  project = google_project.my_project.project_id
  enabled = true
  client_id = "playgames.google.com"
  client_secret = "secret"
  depends_on = [
    google_project_service.identity_platform_apis1,
    google_project_service.identity_platform_apis2,
    google_project_service.identity_platform_apis4,
    google_project_service.identity_platform_apis5,
    google_project_service.identity_platform_apis6,
  ]
}